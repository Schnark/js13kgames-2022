<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>Yellow and Blue</title>
<meta name="viewport" content="width=device-width">
<script src="/socket.io/socket.io.js"></script>
<style>
html,body{margin:0;padding:0}header{background:gray;margin:auto}#canvas{display:block;margin:auto}#info{display:none;position:fixed;top:0;left:0;right:0;background-color:rgba(255,255,255,0.8);text-align:center}#modal{display:none;position:fixed;top:0;bottom:0;left:0;right:0;background-color:rgba(255,255,255,0.8);text-align:center;font-size:500%}</style>
</head><body>
<section id="levels" hidden>
<p><button data-level="1">1</button>
<button data-level="2" disabled>2</button>
</p>
</section>
<section id="game">
<header id="header"><button id="switch">â†”</button> <button id="restart">R</button></header>
<canvas id="canvas"></canvas>
</section>
<div id="info">
<p id="info-text"></p>
</div>
<div id="modal">
<p id="modal-text"></p>
<p><button id="modal-close">OK</button></p>
</div>
<script>
(function(){var l,r,m,n,i,o,p,s,k,t,q;l=function(){function a(d,a){this.isOpen=!1;this.socket=io({upgrade:!1,transports:["websocket"]});this.socket.on("start",function(a){a=JSON.parse(a);this.user=a.user;this.isOpen=!0;d("start",a.user,a.details)}.bind(this));this.socket.on("data",function(a){a=JSON.parse(a);d(a.type,a.user,a.details)});this.socket.on("end",function(a){this.isOpen=!1;d("end",a,{});this.socket.disconnect()}.bind(this));this.socket.on("disconnect",function(){this.isOpen&&d("end",this.user,
{});this.isOpen=!1}.bind(this));this.socket.on("connect",function(){this.socket.emit("start",a||"")}.bind(this))}a.isAvailable=function(){return typeof io!=="undefined"};a.prototype.switchUser=function(){};a.prototype.getUser=function(){return this.user};a.prototype.msg=function(a,c){this.user!==void 0&&this.socket.emit("data",JSON.stringify({type:a,user:this.user,details:c}))};a.prototype.close=function(){this.socket.disconnect(!0)};return a}();r=function(){function a(a,c){this.user=c||0;this.callback=
a;c===void 0&&setTimeout(function(){a("start",0,{seed:Math.floor(Math.random()*4294967296)})},0)}a.prototype.getUser=function(){return this.user};a.prototype.switchUser=function(a){if(this.user!==a)this.user=a,this.callback("switch-user",this.user,{})};a.prototype.msg=function(a,c){this.callback(a,this.user,c)};a.prototype.close=function(){this.callback("end",this.user,{})};return a}();m=10;n=15;i=function(){function a(){f&&(clearTimeout(f),f=!1);b.style.display=""}var d=document.getElementById("modal"),
c=document.getElementById("modal-text"),e=document.getElementById("modal-close"),b=document.getElementById("info"),g=document.getElementById("info-text"),h,f;e.addEventListener("click",function(){d.style.display="";h()});b.addEventListener("click",function(){a()});return{modal:function(b,a){c.textContent=b;h=a;d.style.display="block"},info:function(d,c){g.textContent=d;b.style.display="block";f&&clearTimeout(g);f=setTimeout(a,(c||3)*1E3)}}}();o=function(){var a,d,c,e;document.addEventListener("keydown",
function(b){if(a){switch(b.key&&b.key!=="Unidentified"?{Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"}[b.key]||b.key:{9:"Tab",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown"}[b.which]||String.fromCharCode(b.which).toLowerCase()){case "ArrowLeft":case "a":case "q":a.msg("move",{x:-1,y:0});break;case "ArrowUp":case "w":case "z":a.msg("move",{x:0,y:-1});break;case "ArrowRight":case "d":a.msg("move",{x:1,y:0});break;case "ArrowDown":case "s":a.msg("move",{x:0,y:1});break;
case "1":a.switchUser(0);break;case "2":a.switchUser(1);break;case "Tab":a.switchUser(1-a.getUser());break;case "r":a.msg("restart")}b.preventDefault()}});d=document.getElementById("canvas");d.addEventListener("touchstart",function(b){if(!(b.targetTouches.length>1))c=b.touches[0].clientX,e=b.touches[0].clientY,b.preventDefault()},{passive:!1});d.addEventListener("touchmove",function(b){b.preventDefault()},{passive:!1});d.addEventListener("touchend",function(b){var d,h,f,j;!(b.targetTouches.length>
0)&&a&&(d=b.changedTouches[0].clientX-c,h=b.changedTouches[0].clientY-e,f=Math.abs(d),j=Math.abs(h),Math.max(f,j)>10&&(f>j?a.msg("move",{x:d<0?-1:1,y:0}):a.msg("move",{x:0,y:h<0?-1:1})),b.preventDefault())});document.getElementById("switch").addEventListener("click",function(){a&&a.switchUser(1-a.getUser())});document.getElementById("restart").addEventListener("click",function(){a&&a.msg("restart")});document.getElementById("levels").addEventListener("click",function(b){a&&!b.target.disabled&&b.target.dataset.level&&
a.msg("select",{level:b.target.dataset.level})});return{start:function(b){a=b},stop:function(){a=!1}}}();p=function(){function a(g){d&&(c||(c=g),d(e,g-c),c=g,b(a))}var d,c,e,b;b=window.requestAnimationFrame||window.mozRequestAnimationFrame;(function(){function b(){var c=document.documentElement,c=Math.min(1,c.clientWidth/a.width,(c.clientHeight-d.clientHeight)/a.height);c>0.75?c=0.75:c>2/3?c=2/3:c>0.5?c=0.5:c>1/3?c=1/3:c>0.25&&(c=0.25);c=Math.floor(a.width*c)+"px";a.style.width=c;d.style.width=c}
var a=document.getElementById("canvas"),d=document.getElementById("header");a.width=96*m;a.height=96*n;e=a.getContext("2d");window.addEventListener("resize",b);b()})();return{start:function(g){c=0;d=g;b(a)},stop:function(){d&&d(e);d=!1}}}();s=function(){function a(a,b){this.type=a;this.drawState=this.state=b||0;this.animationTime=0}var d={grass:5E3},c={grass:function(a){a.fillStyle="#060";a.fillRect(0,0,96,96)}};a.prototype.draw=function(a,b,g,h){var f=d[this.type]||1;h===void 0?(this.animationTime=
0,this.drawState=this.state):(this.animationTime=(this.animationTime+h)%f,h*0.0010>=Math.abs(this.state-this.drawState)?this.drawState=this.state:this.drawState+=h*0.0010*(this.state>this.drawState?1:-1));a.save();a.translate(b*96,g*96);c[this.type](a,100*this.animationTime/f,this.drawState);a.restore()};return a}();k=function(){function a(b,a,c,d){b.fillStyle="#fff";b.strokeStyle="#000";b.beginPath();b.arc(a,c,d,0,2*Math.PI);b.fill();b.stroke();b.fillStyle="#000";b.beginPath();b.arc(a,c-d/3,d/3,
0,2*Math.PI);b.fill()}function d(b,a,c){this.type=b;this.drawX=this.x=a;this.drawY=this.y=c;this.animationTime=0}var c={yellow:1E4,blue:12E3,death:5E4},e={yellow:function(b,c){b.translate(48,48);c>50&&c<55&&b.rotate(0.2*Math.sin((c-50)*Math.PI/2.5));b.fillStyle="#ff0";b.fillRect(-38.4,-38.4,76.8,76.8);a(b,-19.2,-9.6,9.6);a(b,19.2,-9.6,9.6)},blue:function(b,c){b.translate(48,48);c>60&&c<70&&b.rotate(Math.sin((c-60)*Math.PI/5));b.fillStyle="#58f";b.beginPath();b.arc(0,0,38.4,0,2*Math.PI);b.fill();a(b,
-19.2,-9.6,9.6);a(b,19.2,-9.6,9.6)},death:function(b,a){b.fillStyle="#fff";b.strokeStyle="#ccc";b.translate(48,72);b.save();b.rotate(Math.sin(a*Math.PI/500)*Math.sin(a*Math.PI/5)/2);b.beginPath();b.moveTo(0,-8);b.lineTo(32,-8);b.bezierCurveTo(40,-8,40,-16,40,0);b.bezierCurveTo(40,16,40,8,32,8);b.lineTo(-32,8);b.bezierCurveTo(-40,8,-40,16,-40,0);b.bezierCurveTo(-40,-16,-40,-8,-32,-8);b.closePath();b.fill();b.stroke();b.restore();b.beginPath();b.moveTo(0,-96*0.7);b.bezierCurveTo(32,-96*0.7,40,-48,40,
-96*0.3);b.bezierCurveTo(40,-96*0.1,4,96*0.2,0,96*0.2);b.bezierCurveTo(-4,96*0.2,-40,-96*0.1,-40,-96*0.3);b.bezierCurveTo(-40,-48,-32,-96*0.7,0,-96*0.7);b.fill();b.stroke();b.fillStyle="#900";b.beginPath();b.arc(-19.2,-32,12,0,2*Math.PI);b.arc(19.2,-32,12,0,2*Math.PI);b.fill()}};d.prototype.setRoom=function(b){this.room=b};d.prototype.canMoveTo=function(b,a){return this.room&&this.room.getType(b,a)==="grass"};d.prototype.moveTo=function(b,a){this.drawX=this.x;this.drawY=this.y;this.x=b;this.y=a};
d.prototype.draw=function(b,a){var d=c[this.type]||1,f,j,i;a===void 0?(this.animationTime=0,this.drawX=this.x,this.drawY=this.y):(this.animationTime=(this.animationTime+a)%d,f=this.x-this.drawX,j=this.y-this.drawY,i=Math.sqrt(f*f+j*j),a*0.0050>=i?(this.drawX=this.x,this.drawY=this.y):(this.drawX+=f*a*0.0050/i,this.drawY+=j*a*0.0050/i));b.save();b.translate(this.drawX*96,this.drawY*96);e[this.type](b,100*this.animationTime/d);b.restore()};return d}();t=function(){function a(){var a,c,e;this.tiles=
[];for(c=0;c<n;c++){e=[];for(a=0;a<m;a++)e.push(new s("grass"));this.tiles.push(e)}this.movables=[]}a.prototype.addMovable=function(a){this.movables.push(a);a.setRoom(this)};a.prototype.getType=function(a,c){return c<0||c>=this.tiles.length?"":a<0||a>=this.tiles[c].length?"":this.tiles[c][a].type};a.prototype.draw=function(a,c){var e,b;for(b=0;b<this.tiles.length;b++)for(e=0;e<this.tiles[b].length;e++)this.tiles[b][e].draw(a,e,b,c);for(e=0;e<this.movables.length;e++)this.movables[e].draw(a,c)};return a}();
q=function(){function a(a){this.data=a}a.prototype.init=function(){this.room=new t;this.yellow=new k("yellow",0,this.data===0?0:14);this.blue=new k("blue",9,this.data===0?14:0);this.death=new k("death",4,7);this.room.addMovable(this.yellow);this.room.addMovable(this.blue);this.room.addMovable(this.death)};a.prototype.start=function(a){o.start(a);p.start(this.room.draw.bind(this.room));this.state=!1};a.prototype.stop=function(){o.stop();p.stop()};a.prototype.getState=function(){return this.state};
a.prototype.move=function(a,c,e){function b(a){var b,d;b=a.x+c;d=a.y+e;if(a.canMoveTo(b,d))return a.moveTo(b,d),!0}if(!this.state&&(a=b(a===0?this.yellow:this.blue),this.state=this.checkEnd(),a&&!this.state))b(this.death),this.state=this.checkEnd()};a.prototype.checkEnd=function(){function a(c,d){return Math.abs(c.x-d.x)+Math.abs(c.y-d.y)<=1}if(a(this.yellow,this.death))return"Yellow died!";if(a(this.blue,this.death))return"Blue died!";if(a(this.yellow,this.blue))return"You win!"};return a}();(function(){function a(a,
b,g){switch(a){case "start":c.init();c.start(d);break;case "end":c.stop();break;case "move":if(c&&!c.getState()&&(c.move(b,g.x,g.y),a=c.getState()))c.stop(),i.modal(a,function(){d.msg("continue")});break;case "restart":c&&!c.getState()&&(b!==d.getUser()&&i.info("Level restarted by other user"),c.stop(),c.init(),c.start(d));break;case "continue":c&&c.getState()&&(c.init(),c.start(d));break;case "select":c||(b!==d.getUser()&&i.info("Level selected by other user"),c=new q(g.level))}}var d,c=new q(0);
d=l.isAvailable()?new l(a):new r(a)})()})();
</script>
</body></html>