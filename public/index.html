<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>Yellow and Blue</title>
<meta name="viewport" content="width=device-width">
<script src="/socket.io/socket.io.js"></script>
<style>
html,body{margin:0;padding:0;font-family:sans-serif}section:not(#game){padding:0.5em 1em}header{background:gray;margin:auto}.yellow #blue,.blue #yellow{display:none}#blue{color:#00f}#yellow{color:#ff0}#canvas{display:block;margin:auto}#info{display:none;position:fixed;top:0;left:0;right:0;background-color:rgba(255,255,255,0.8);text-align:center}#modal{display:none;position:fixed;top:0;bottom:0;left:0;right:0;background-color:rgba(255,255,255,0.7);text-align:center;font-size:500%;overflow:auto}</style>
</head><body>
<section id="levels" hidden>
</section>
<section id="game" hidden>
<header id="header"><button id="abort">X</button> <button id="switch"><span id="yellow">▪</span><span id="blue">●</span></button> <button id="restart">R</button></header>
<canvas id="canvas" moz-opaque></canvas>
</section>
<div id="info">
<p id="info-text"></p>
</div>
<div id="modal">
<p id="modal-text"></p>
<p><button id="modal-close">OK</button></p>
</div>
<script>
(function(){var p,q,r,l,m,s,u,v,w,t,n,j;p=function(){function c(e,b){this.isOpen=!1;this.socket=io({upgrade:!1,transports:["websocket"]});this.socket.on("start",function(a){a=JSON.parse(a);this.user=a.user;this.isOpen=!0;e("start",a.user,a.details)}.bind(this));this.socket.on("data",function(a){a=JSON.parse(a);e(a.type,a.user,a.details)});this.socket.on("end",function(a){this.isOpen=!1;e("end",a,{});this.socket.disconnect()}.bind(this));this.socket.on("disconnect",function(){this.isOpen&&e("end",
this.user,{});this.isOpen=!1}.bind(this));this.socket.on("connect",function(){this.socket.emit("start",b||"")}.bind(this))}c.isAvailable=function(){return typeof io!=="undefined"};c.prototype.switchUser=function(){};c.prototype.getUser=function(){return this.user};c.prototype.msg=function(e,b){this.user!==void 0&&this.socket.emit("data",JSON.stringify({type:e,user:this.user,details:b}))};c.prototype.close=function(){this.socket.disconnect(!0)};return c}();q=function(){function c(e,b){this.user=b||
0;this.callback=e;b===void 0&&setTimeout(function(){e("start",0,{seed:Math.floor(Math.random()*4294967296)})},0)}c.prototype.getUser=function(){return this.user};c.prototype.switchUser=function(e){if(this.user!==e)this.user=e,this.callback("switch-user",this.user,{})};c.prototype.msg=function(e,b){this.callback(e,this.user,b)};c.prototype.close=function(){this.callback("end",this.user,{})};return c}();r=function(){return{get:function(c,e){return e},set:function(){}}}();l=function(){function c(){f&&
(clearTimeout(f),f=!1);d.style.display=""}var e=document.getElementById("modal"),b=document.getElementById("modal-text"),a=document.getElementById("modal-close"),d=document.getElementById("info"),h=document.getElementById("info-text"),k,f;a.addEventListener("click",function(){e.style.display="";k()});d.addEventListener("click",function(){c()});return{modal:function(d,h){b.textContent=d;k=h;e.style.display="block";a.focus()},info:function(a,b){a?(h.textContent=a,d.style.display="block",f&&clearTimeout(h),
f=setTimeout(c,(b||3)*1E3)):c()}}}();m=function(){function c(){e&&e.msg("unlock",{data:"bonus"})}var e,b=!1,a,d,h;document.addEventListener("keydown",function(d){if(e&&b&&!d.altKey&&!d.ctrlKey&&!d.metaKey){switch(d.key&&d.key!=="Unidentified"?{Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"}[d.key]||d.key:{9:"Tab",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown"}[d.which]||String.fromCharCode(d.which).toLowerCase()){case "ArrowLeft":case "a":case "q":e.msg("move",{x:-1,
y:0});break;case "ArrowUp":case "w":case "z":e.msg("move",{x:0,y:-1});break;case "ArrowRight":case "d":e.msg("move",{x:1,y:0});break;case "ArrowDown":case "s":e.msg("move",{x:0,y:1});break;case "1":e.switchUser(0);break;case "2":e.switchUser(1);break;case "Tab":e.switchUser(1-e.getUser());break;case "r":e.msg("restart")}d.preventDefault()}});a=document.getElementById("canvas");a.addEventListener("touchstart",function(a){if(!(a.targetTouches.length>1))d=a.touches[0].clientX,h=a.touches[0].clientY,
a.preventDefault()},{passive:!1});a.addEventListener("touchmove",function(d){d.preventDefault()},{passive:!1});a.addEventListener("touchend",function(a){var b,c,g,o;!(a.targetTouches.length>0)&&e&&(b=a.changedTouches[0].clientX-d,c=a.changedTouches[0].clientY-h,g=Math.abs(b),o=Math.abs(c),Math.max(g,o)>10&&(g>o?e.msg("move",{x:b<0?-1:1,y:0}):e.msg("move",{x:0,y:c<0?-1:1})),a.preventDefault())});document.getElementById("abort").addEventListener("click",function(){e&&e.msg("abort")});document.getElementById("switch").addEventListener("click",
function(){e&&e.switchUser(1-e.getUser())});document.getElementById("restart").addEventListener("click",function(){e&&e.msg("restart")});document.getElementById("levels").addEventListener("click",function(d){e&&!d.target.disabled&&d.target.dataset.level&&e.msg("select",{level:Number(d.target.dataset.level)})});document.monetization&&document.monetization.addEventListener("monetizationstart",c);return{start:function(d){e=d},stop:function(){e=!1},startKeys:function(){b=!0},stopKeys:function(){b=!1}}}();
s=function(){function c(h){e&&(b||(b=h),e(a,h-b),b=h,d(c))}var e,b,a,d;d=window.requestAnimationFrame||window.mozRequestAnimationFrame;(function(){function d(){var a=document.documentElement,a=Math.min(1,a.clientWidth/b.width,(a.clientHeight-c.clientHeight)/b.height);a>0.75?a=0.75:a>2/3?a=2/3:a>0.5?a=0.5:a>1/3?a=1/3:a>0.25&&(a=0.25);a=Math.floor(b.width*a)+"px";b.style.width=a;c.style.width=a}var b=document.getElementById("canvas"),c=document.getElementById("header");b.width=960;b.height=1440;a=b.getContext("2d",
{alpha:!1});window.addEventListener("resize",d);d()})();return{start:function(a){b=0;e=a;d(c)},stop:function(){e&&e(a);e=!1}}}();u=function(){function c(a,d){this.type=a;d===0||d===1?this.state=d:(this.data=d,this.state=0);this.drawState=this.state;this.animationTime=0}var e={fire:1E4,teleport:15E3},b={grass:function(a){a.fillStyle="#060";a.fillRect(0,0,96,96)},block:function(a){a.fillStyle="#000";a.fillRect(0,0,96,96);a.strokeStyle="#fff";a.beginPath();a.moveTo(0,0);a.lineTo(96,0);a.moveTo(0,24);
a.lineTo(96,24);a.moveTo(0,48);a.lineTo(96,48);a.moveTo(0,72);a.lineTo(96,72);a.moveTo(0,0);a.lineTo(0,24);a.moveTo(48,0);a.lineTo(48,24);a.moveTo(0,48);a.lineTo(0,72);a.moveTo(48,48);a.lineTo(48,72);a.moveTo(24,24);a.lineTo(24,48);a.moveTo(72,24);a.lineTo(72,48);a.moveTo(24,72);a.lineTo(24,96);a.moveTo(72,72);a.lineTo(72,96);a.stroke()},fire:function(a,d){a.fillStyle="hsl(0,100%,"+(50+10*Math.sin(d*Math.PI/50))+"%)";a.fillRect(0,0,96,96)}};b.doc=function(a){b.grass(a);a.fillStyle="#fff";a.strokeStyle=
"#000";a.lineWidth=1.5;a.beginPath();a.moveTo(64,40);a.lineTo(48,24);a.lineTo(32,24);a.lineTo(32,72);a.lineTo(64,72);a.lineTo(64,40);a.fill();a.lineTo(48,40);a.lineTo(48,24);a.stroke()};b.hdoor=function(a,d,h){d=48-h*46;b.grass(a);a.fillStyle="#aaa";a.rect(0,0,d,12);a.rect(0,84,d,12);a.rect(96-d,0,d,12);a.rect(96-d,84,d,12);a.fill()};b.vdoor=function(a,d,h){d=48-h*46;b.grass(a);a.fillStyle="#aaa";a.rect(0,0,12,d);a.rect(84,0,12,d);a.rect(0,96-d,12,d);a.rect(84,96-d,12,d);a.fill()};b.trigger=function(a){b.grass(a);
a.fillStyle="#aaa";a.fillRect(24,24,48,48)};b.teleport=function(a,d){b.grass(a);a.fillStyle="#a0a";a.beginPath();a.arc(48,48,24+8*Math.sin(d*Math.PI/50),0,2*Math.PI);a.fill()};c.prototype.canEnter=function(){return this.type==="vdoor"||this.type==="hdoor"?this.state===1:this.type!=="block"};c.prototype.getDeath=function(){return this.type==="fire"?1:(this.type==="vdoor"||this.type==="hdoor")&&this.state===0?2:this.type==="teleport"?3:0};c.prototype.draw=function(a,d,h,c){var f=e[this.type]||1;c===
void 0?(this.animationTime=0,this.drawState=this.state):(this.animationTime=(this.animationTime+c)%f,c*0.0010>=Math.abs(this.state-this.drawState)?this.drawState=this.state:this.drawState+=c*0.0010*(this.state>this.drawState?1:-1));a.save();a.translate(d*96,h*96);b[this.type](a,100*this.animationTime/f,this.drawState);a.restore()};return c}();v=function(){function c(d,a,b,c){d.fillStyle="#fff";d.strokeStyle="#000";d.beginPath();d.arc(a,b,c,0,2*Math.PI);d.fill();d.stroke();d.fillStyle="#000";d.beginPath();
d.arc(a,b-c/3,c/3,0,2*Math.PI);d.fill()}function e(a,b,c){this.type=a;this.drawX=this.x=b;this.drawY=this.y=c;this.animationTime=0}var b={yellow:1E4,blue:12E3,death:5E4},a={yellow:function(a,b){a.translate(48,48);b>50&&b<55&&a.rotate(0.2*Math.sin((b-50)*Math.PI/2.5));a.fillStyle="#ff0";a.fillRect(-38.4,-38.4,76.8,76.8);c(a,-19.2,-9.6,9.6);c(a,19.2,-9.6,9.6)},blue:function(a,b){a.translate(48,48);b>60&&b<70&&a.rotate(Math.sin((b-60)*Math.PI/5));a.fillStyle="#58f";a.beginPath();a.arc(0,0,38.4,0,2*Math.PI);
a.fill();c(a,-19.2,-9.6,9.6);c(a,19.2,-9.6,9.6)},death:function(a,b){a.fillStyle="#fff";a.strokeStyle="#ccc";a.translate(48,72);a.save();a.rotate(Math.sin(b*Math.PI/500)*Math.sin(b*Math.PI/5)/2);a.beginPath();a.moveTo(0,-8);a.lineTo(32,-8);a.bezierCurveTo(32,-8,40,-24,40,0);a.bezierCurveTo(40,24,32,8,32,8);a.lineTo(-32,8);a.bezierCurveTo(-32,8,-40,24,-40,0);a.bezierCurveTo(-40,-24,-32,-8,-32,-8);a.closePath();a.fill();a.stroke();a.restore();a.beginPath();a.moveTo(0,-96*0.7);a.bezierCurveTo(32,-96*
0.7,40,-48,40,-32);a.bezierCurveTo(40,-96*0.1,4,96*0.2,0,96*0.2);a.bezierCurveTo(-4,96*0.2,-40,-96*0.1,-40,-32);a.bezierCurveTo(-40,-48,-32,-96*0.7,0,-96*0.7);a.fill();a.stroke();a.fillStyle="#900";a.beginPath();a.arc(-19.2,-32,12,0,2*Math.PI);a.arc(19.2,-32,12,0,2*Math.PI);a.fill()},box:function(a){a.fillStyle="#732";a.fillRect(0,0,96,96)}};e.prototype.setRoom=function(a){if(this.room!==a)this.room&&this.room.movables.splice(this.room.movables.indexOf(this),1),this.room=a};e.prototype.getTile=function(){return this.room.getTile(this.x,
this.y)};e.prototype.canMoveTo=function(a,b,c,e){return!this.room.canEnter(a,b)?!1:!this.room.isOccupied(a,b)?!0:this.room.canEnter(a+c,b+e)&&!this.room.isOccupied(a+c,b+e)};e.prototype.moveTo=function(a,b,c){this.drawX=c?a:this.x;this.drawY=c?b:this.y;this.x=a;this.y=b};e.prototype.draw=function(d,c){var e=b[this.type]||1,f,i,g;c===void 0?(this.animationTime=0,this.drawX=this.x,this.drawY=this.y):(this.animationTime=(this.animationTime+c)%e,f=this.x-this.drawX,i=this.y-this.drawY,g=Math.sqrt(f*f+
i*i),c*0.0050>=g?(this.drawX=this.x,this.drawY=this.y):(this.drawX+=f*c*0.0050/g,this.drawY+=i*c*0.0050/g));d.save();d.translate(this.drawX*96,this.drawY*96);a[this.type](d,100*this.animationTime/e);d.restore()};return e}();w=function(){function c(){}var e={"#":"block","~":"fire","!":"doc","-":"hdoor","|":"vdoor",".":"trigger","*":"trigger","?":"teleport"},b={0:"yellow",1:"blue",2:"death",3:"death",$:"box","*":"box"};c.prototype.init=function(a){var d=0,c,k,f,i,g,o,j={};this.tiles=[];this.movables=
[];for(f=0;f<15;f++){i=[];for(k=0;k<10;k++){c=a.map.charAt(d);if(g=b[c])o=new v(g,k,f),this.addMovable(o),j[g]=o;g=a[c]?a[c].shift():void 0;i.push(new u(e[c]||"grass",g));d++}this.tiles.push(i)}return j};c.prototype.addMovable=function(a){this.movables.indexOf(a)===-1&&(this.movables.push(a),a.setRoom(this))};c.prototype.getTile=function(a,b){return this.tiles[b][a]};c.prototype.canEnter=function(a,b){return b<0||b>=this.tiles.length?!1:a<0||a>=this.tiles[b].length?!1:this.tiles[b][a].canEnter()};
c.prototype.isOccupied=function(a,b){var c;for(c=0;c<this.movables.length;c++)if(this.movables[c].x===a&&this.movables[c].y===b)return this.movables[c];return!1};c.prototype.draw=function(a,b){var c,e;for(e=0;e<this.tiles.length;e++)for(c=0;c<this.tiles[e].length;c++)this.tiles[e][c].draw(a,c,e,b);for(c=0;c<this.movables.length;c++)this.movables[c].draw(a,b)};return c}();t=function(){function c(b){this.data=b}function e(b,a){return b.room===a.room&&Math.abs(b.x-a.x)+Math.abs(b.y-a.y)<=1}c.prototype.init=
function(){var b,a=JSON.parse(JSON.stringify(this.data));this.inverseMove=this.data.map.indexOf("3")>-1;this.rooms=[];do b=new w,this.rooms.push(b),b=b.init(a),a.map=a.map.slice(150),this.yellow=b.yellow||this.yellow,this.blue=b.blue||this.blue,this.death=b.death||this.death;while(a.map.length>0)};c.prototype.start=function(b){this.init();m.startKeys();s.start(this.draw.bind(this));this.state=0;this.user=b;this.time=Date.now()};c.prototype.stop=function(){m.stopKeys();s.stop();return Math.max(1,Math.round((Date.now()-
this.time)/1E3))};c.prototype.setUser=function(b){this.user=b};c.prototype.draw=function(b,a){[this.yellow,this.blue][this.user].room.draw(b,a)};c.prototype.getState=function(){return this.state};c.prototype.movePlayer=function(b,a,d){var c,e,f;c=b.x+a;e=b.y+d;if(b.canMoveTo(c,e,a,d))return(f=b.room.isOccupied(c,e))&&this.movePlayer(f,a,d),this.enterLeave(b,!1),b.moveTo(c,e),this.enterLeave(b,!0),!0};c.prototype.move=function(b,a,c){if(!this.state&&(b=this.movePlayer(b===0?this.yellow:this.blue,a,
c),this.state=this.checkEnd(),b&&this.state<=1))this.movePlayer(this.death,this.inverseMove?-a:a,this.inverseMove?-c:c),this.state=this.checkEnd()};c.prototype.enterLeave=function(b,a){var c=b.getTile();if(c.type==="doc")b===[this.yellow,this.blue][this.user]&&l.info(a?c.data:"");else if(c.type==="trigger")c=c.data,this.rooms[c[2]].getTile(c[0],c[1]).state=a?1:0;else if(c.type==="teleport"&&a)c=c.data,this.rooms[c[2]].isOccupied(c[0],c[1])||(this.rooms[c[2]].addMovable(b),b.moveTo(c[0],c[1],!0))};
c.prototype.checkDeath=function(b){return e(b,this.death)?1:(b=b.getTile().getDeath())?b+1:0};c.prototype.checkEnd=function(){var b,a;(b=this.checkDeath(this.yellow))&&(b*=2);return(a=this.checkDeath(this.blue))?2*a+1:b&&a?[b,a][this.user]:b?b:a?a:e(this.yellow,this.blue)?1:0};return c}();n=function(){var c={map:"0                                                                         2                                                                          1"};return[{title:"Tutorial",desc:"Play these tutorial levels first.",
lock:0,levels:[{map:"   #       0!          #      ####                  #####     #   #     # 2 #     #   #     ## ##                   ####      #          !1       #   ","!":["Welcome! Try to meet Blue, but avoid Death.","Welcome! Try to meet Yellow, but avoid Death."]},{map:"0  !          ~            ~               ~      ~        ~              3                ~      ~               ~      ~           ~            !  1","!":["This time Death will move the other way. And don\u2019t fall into the fire pits!",
"This time Death will move the other way. And don\u2019t fall into the fire pits!"]},{map:"0 !             .             #####-####                                  2                 .                 ####-#####                           ! 1","!":["The triggers will open and close the doors.","The triggers will open and close the doors."],".":[[4,11,0],[5,3,0]]},{map:"0 !           ?               ##########                                  2                                   ##########              ?            ! 1",
"!":["The teleporters will take you somewhere else. Let\u2019s hope the place is free and safe!","The teleporters will take you somewhere else. Let\u2019s hope the place is free and safe!"],"?":[[4,4,0],[5,10,0]]},{map:"0!$         $       $$$                             $$$$$     $   $     $ 2 $     $   $     $$$$$                              $$$       $ !       $ 1","!":["You can push boxes to a free place, but only one at a time.","You can push boxes to a free place, but only one at a time."]},
{map:"0 !                                                                                                                                                  ??                                                                                                                                                  ! 1                                                                          2                                                                           ","!":["Where is Blue? Perhaps you should use the teleporter.",
"Where is Yellow? Perhaps you should use the teleporter."],"?":[[0,0,2],[9,14,2]]}]},{title:"Group 1",desc:"Solve all the tutorial levels to unlock.",lock:6,levels:[c,c,c,c]},{title:"Group 2",desc:"Solve eight levels to unlock.",lock:8,levels:[c,c,c,c]},{title:"Bonus",desc:"Bonus levels",lock:"bonus",levels:[c,c,c,c]}]}();j=function(){function c(){b.hidden=!1;a.hidden=!0}function e(a){var b;if(a==="bonus"){if(!f){for(b=0;b<i.length;b++)if(i[b].lock==="bonus")document.querySelector('[data-level="'+
b+'"]').disabled=!1;f=!0}}else if(a>k){for(b=0;b<i.length;b++)if(i[b].lock>k&&i[b].lock<=a)document.querySelector('[data-level="'+b+'"]').disabled=!1;k=a}}var b=document.getElementById("levels"),a=document.getElementById("game"),d,h,k,f,i;return{init:function(){k=-1;f=!1;var a=b,d;d=[];var h,j,l,m;i=[];for(h=0;h<n.length;h++){d.push("<h2>"+n[h].title+"</h2>");d.push("<p>"+n[h].desc+"</p>");d.push("<p>");for(j=0;j<n[h].levels.length;j++)l=n[h].levels[j],m=i.length+1+' <span class="result"></span>',
d.push('<button data-level="'+i.length+'" disabled>'+m+"</button> "),i.push({lock:n[h].lock,def:l});d.push("</p>")}d=d.join("");a.innerHTML=d;e(0);c()},getCurrentLevel:function(){return d},getCurrentLevelId:function(){return h},unlock:e,markSolved:function(a,b){document.querySelector('[data-level="'+a+'"] .result').textContent="\u2713 ("+b+")"},runNextLevel:function(a){var b;b=h+1;i[b]?(b=i[b].lock,b=b==="bonus"?f:b<=k):b=!1;h=b?h+1:-1;h===-1?(d=!1,c()):(d=new t(i[h].def),d.start(a))},runLevel:function(c,
e){h=c;d=new t(i[h].def);d.start(e);b.hidden=!0;a.hidden=!1},abortLevel:function(){d.stop();h=-1;d=!1;c()}}}();(function(){function c(){return location.search==="?monetization-cheater"||document.monetization&&document.monetization.state==="started"}function e(k,f,i){var g=j.getCurrentLevel();switch(k){case "start":a.className=["yellow","blue"][f];m.start(b);j.init();Object.keys(d).forEach(function(a){j.markSolved(a,Math.floor(d[a]/60)+":"+(d[a]%60<10?"0"+d[a]%60:d[a]%60))});b.msg("unlock",{data:Object.keys(d).length});
c()&&b.msg("unlock",{data:"bonus"});break;case "end":m.stop();f===b.getUser()?g&&j.abortLevel():(l.modal("The other user quit. You can continue to play alone.",function(){}),b=new q(e,b.getUser()),m.start(b));break;case "switch-user":a.className=["yellow","blue"][f];g&&g.setUser(f);break;case "move":if(g&&!g.getState()&&(g.move(f,i.x,i.y),f=g.getState())){g=g.stop();k=h[f-1];if(f===1&&(f=j.getCurrentLevelId(),i=Math.floor(g/60)+":"+(g%60<10?"0"+g%60:g%60),k+=" ("+i+")",!d[f]||d[f]>g))d[f]=g,r.set("solved",
d),j.markSolved(f,i),b.msg("unlock",{data:Object.keys(d).length});l.info("");l.modal(k,function(){b.msg("continue")})}break;case "restart":g&&!g.getState()&&(f!==b.getUser()&&l.info("Level restarted by other user"),g.stop(),g.start(b.getUser()));break;case "continue":g&&g.getState()&&(g.getState()>1?g.start(b.getUser()):j.runNextLevel(b.getUser()));break;case "select":g||(f!==b.getUser()&&l.info("Level selected by other user"),j.runLevel(i.level,b.getUser()));break;case "abort":g&&!g.getState()&&
(f!==b.getUser()&&l.info("Level aborted by other user"),j.abortLevel());break;case "unlock":i.data==="bonus"&&!c()&&l.info("Bonus levels unlocked by other user"),j.unlock(i.data)}}var b,a=document.getElementById("switch"),d=r.get("solved",{}),h="You win!,Yellow died!,Blue died!,Yellow burnt!,Blue burnt!,Yellow was crushed in a closing door!,Blue was crushed in a closing door!,Yellow got stuck in a teleporter!,Blue got stuck in a teleporter!".split(",");b=p.isAvailable()?new p(e):new q(e)})()})();
</script>
</body></html>