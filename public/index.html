<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>Yellow and Blue</title>
<meta name="viewport" content="width=device-width">
<meta name="monetization" content="$ilp.uphold.com/k4eJGQUDF9nw">
<script src="/socket.io/socket.io.js"></script>
<style>
html,body{margin:0;padding:0;font-family:sans-serif;height:100%}section:not(#game){padding:0.5em 1em}header{background:#000;margin:auto;position:relative;z-index:1;text-align:center}header button{background:none;border:0;color:#fff;padding:0.5em}.left{float:left}.right{float:right}.yellow #blue,.blue #yellow{display:none}#game{background:linear-gradient(90deg,#aac,#dd9);height:100%}#canvas{display:block;margin:auto;box-shadow:2em 2em #000,-2em -3em #000,2em -3em #000,-2em 2em #000;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges}#start{text-align:center}#start button{background:#fff;color:#000;border:solid thin;font:inherit;padding:1em;width:15em;transition:width 0.2s;cursor:pointer}#start button:hover:not(:disabled){transition:width 0.5s;width:20em}#start button:disabled{color:#888}#levels button{background:#fff;color:#000;border:solid;font:inherit;font-size:150%;font-weight:bold;width:3em;height:3em;cursor:pointer}#levels button .result{font-weight:normal;font-size:67%}#levels button:hover:not(:disabled){border-color:#00f}#levels button:disabled{color:#888;cursor:default}#levels button.solved{background:#060;border-color:#060;color:#fff}#info{display:none;position:fixed;z-index:2;top:0;left:0;right:0;background-color:rgba(255,255,255,0.8);text-align:center}#modal{display:none;position:fixed;z-index:2;top:0;bottom:0;left:0;right:0;background-color:rgba(255,255,255,0.7);text-align:center;font-size:500%;overflow:auto}#modal p{padding:0 1em}</style>
</head><body>
<section id="start">
<p><button id="alone">Play alone</button></p>
<p><button id="friend">Play with a friend</button></p>
<p><button id="random">Play with a random person</button></p>
</section>
<section id="code" hidden>
<p>Think of any word or other code and tell it your friend. Then you both enter that code to play together.</p>
<p><label>Code: <input id="input"></label></p>
<p><button id="connect">Connect</button></p>
<p><button id="back">Cancel</button></p>
</section>
<section id="wait" hidden>
<p>Waiting for other player â€¦</p>
<p><button id="cancel">Cancel</button></p>
</section>
<section id="levels" hidden>
</section>
<section id="game" hidden>
<header id="header"><button id="abort" class="left" title="Abort level"><svg height="24px" width="24px" viewBox="0 0 24 24" fill="currentcolor"><path d="M18.3,5.71L18.3,5.71c-0.39-0.39-1.02-0.39-1.41,0L12,10.59L7.11,5.7c-0.39-0.39-1.02-0.39-1.41,0l0,0c-0.39,0.39-0.39,1.02,0,1.41L10.59,12L5.7,16.89c-0.39,0.39-0.39,1.02,0,1.41h0c0.39,0.39,1.02,0.39,1.41,0L12,13.41l4.89,4.89 c0.39,0.39,1.02,0.39,1.41,0l0,0c0.39-0.39,0.39-1.02,0-1.41L13.41,12l4.89-4.89C18.68,6.73,18.68,6.09,18.3,5.71z"/></svg></button> <button id="switch"><svg id="yellow" height="24px" width="24px" viewBox="0 0 24 24" fill="#ff0"><path d="M2 2H20V20H2V2"/></svg><svg id="blue" height="24px" width="24px" viewBox="0 0 24 24" fill="#58f"><circle r="10" cx="12" cy="12"/></svg></button> <button id="restart" class="right" title="Restart level [r]"><svg height="24px" width="24px" viewBox="0 0 24 24" fill="currentcolor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg></button></header>
<canvas id="canvas" moz-opaque></canvas>
</section>
<div id="info">
<p id="info-text"></p>
</div>
<div id="modal">
<p id="modal-text"></p>
<p><button id="modal-close">OK</button></p>
</div>
<script>
(function(){var o,q,v,n,p,r,w,x,y,u,s,m;o=function(){function c(c,b){this.isOpen=!1;this.socket=io({upgrade:!1,transports:["websocket"]});this.socket.on("start",function(a){a=JSON.parse(a);this.user=a.user;this.isOpen=!0;c("start",a.user,a.details)}.bind(this));this.socket.on("data",function(a){a=JSON.parse(a);c(a.type,a.user,a.details)});this.socket.on("end",function(a){this.isOpen=!1;c("end",a,{});this.socket.disconnect()}.bind(this));this.socket.on("disconnect",function(){this.isOpen&&c("end",
this.user,{});this.isOpen=!1}.bind(this));this.socket.on("connect",function(){this.socket.emit("start",b||"")}.bind(this))}c.isAvailable=function(){return typeof io!=="undefined"};c.prototype.switchUser=function(){};c.prototype.getUser=function(){return this.user};c.prototype.msg=function(c,b){this.user!==void 0&&this.socket.emit("data",JSON.stringify({type:c,user:this.user,details:b}))};c.prototype.close=function(){this.socket.disconnect(!0)};return c}();q=function(){function c(c,b){this.user=b||
0;this.callback=c;b===void 0&&setTimeout(function(){c("start",0,{seed:Math.floor(Math.random()*4294967296)})},0)}c.prototype.getUser=function(){return this.user};c.prototype.switchUser=function(c){if(this.user!==c)this.user=c,this.callback("switch-user",this.user,{})};c.prototype.msg=function(c,b){this.callback(c,this.user,b)};c.prototype.close=function(){this.callback("end",this.user,{})};return c}();v=function(){var c={solved:{}};try{c=JSON.parse(sessionStorage.getItem("schnark-js13k-2022")||"x")}catch(e){}return{get:function(b){return c[b]},
set:function(b,a){c[b]=a;try{sessionStorage.setItem("schnark-js13k-2022",JSON.stringify(c))}catch(d){}}}}();n=function(){function c(){h&&(clearTimeout(h),h=!1);d.style.display=""}var e=document.getElementById("modal"),b=document.getElementById("modal-text"),a=document.getElementById("modal-close"),d=document.getElementById("info"),g=document.getElementById("info-text"),l,h;a.addEventListener("click",function(){e.style.display="";l()});d.addEventListener("click",function(){c()});return{modal:function(d,
g){b.textContent=d;l=g;e.style.display="block";a.focus()},info:function(a,b){a?(g.textContent=a,d.style.display="block",h&&clearTimeout(g),h=setTimeout(c,(b||3)*1E3)):c()}}}();p=function(){function c(){e&&e.msg("unlock",{data:"bonus"})}var e,b=!1,a,d,g;document.addEventListener("keydown",function(a){if(e&&b&&!a.altKey&&!a.ctrlKey&&!a.metaKey){switch(a.key&&a.key!=="Unidentified"?{Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"}[a.key]||a.key:{9:"Tab",37:"ArrowLeft",38:"ArrowUp",
39:"ArrowRight",40:"ArrowDown"}[a.which]||String.fromCharCode(a.which).toLowerCase()){case "ArrowLeft":case "a":case "q":e.msg("move",{x:-1,y:0});break;case "ArrowUp":case "w":case "z":e.msg("move",{x:0,y:-1});break;case "ArrowRight":case "d":e.msg("move",{x:1,y:0});break;case "ArrowDown":case "s":e.msg("move",{x:0,y:1});break;case "1":e.switchUser(0);break;case "2":e.switchUser(1);break;case "Tab":e.switchUser(1-e.getUser());break;case "r":e.msg("restart")}a.preventDefault()}});a=document.getElementById("canvas");
a.addEventListener("touchstart",function(a){if(!(a.targetTouches.length>1))d=a.touches[0].clientX,g=a.touches[0].clientY,a.preventDefault()},{passive:!1});a.addEventListener("touchmove",function(a){a.preventDefault()},{passive:!1});a.addEventListener("touchend",function(a){var b,f,c,k;!(a.targetTouches.length>0)&&e&&(b=a.changedTouches[0].clientX-d,f=a.changedTouches[0].clientY-g,c=Math.abs(b),k=Math.abs(f),Math.max(c,k)>10&&(c>k?e.msg("move",{x:b<0?-1:1,y:0}):e.msg("move",{x:0,y:f<0?-1:1})),a.preventDefault())});
document.getElementById("abort").addEventListener("click",function(){e&&e.msg("abort")});document.getElementById("switch").addEventListener("click",function(){e&&e.switchUser(1-e.getUser())});document.getElementById("restart").addEventListener("click",function(){e&&e.msg("restart")});document.getElementById("levels").addEventListener("click",function(a){e&&!a.target.disabled&&a.target.dataset.level&&e.msg("select",{level:Number(a.target.dataset.level)})});document.monetization&&document.monetization.addEventListener("monetizationstart",
c);return{start:function(a){e=a},stop:function(){e=!1},startKeys:function(){b=!0},stopKeys:function(){b=!1}}}();(function(){function c(a,d){var b,g,d=d||"sine";for(b=0;b<f.length;b++)if(f[b].osc.type===d&&f[b].t<a)return b;b=h.createOscillator();g=h.createGain();b.type=d;g.gain.value=0;b.connect(g);g.connect(h.destination);b.start();f.push({osc:b,gain:g});return f.length-1}function e(){var a,d;if(g){h||(h=new l);for(a=0;a<i.length;a++){if(i[a].time===-1)d||(d=h.currentTime+0.1),i[a].time=d;for(var b=
i[a],e=void 0;b.time-h.currentTime<1;){e=b.notes[b.pos];if(e[0][0]==="z")b.time+=e[1]*b.baseDur;else{for(var m=b,z=e[0],n=b.time,r=b.key,s=b.volume,p=void 0,e=n+e[1]*b.baseDur,p=0;p<z.length;p++){var o=n,q=e,v=r[z[p]],u=s,t=c(o);f[t].osc.frequency.setValueAtTime(v,o);f[t].gain.gain.setValueAtTime(0.0010,o);f[t].gain.gain.exponentialRampToValueAtTime(u,o+0.05);f[t].gain.gain.linearRampToValueAtTime(u,q-0.05);f[t].gain.gain.exponentialRampToValueAtTime(0.0010,q);f[t].gain.gain.setValueAtTime(0,q+0.01);
f[t].t=q+0.01}m.time=e}b.pos=(b.pos+1)%b.notes.length}}}}function b(a){return a.split(" ").map(function(a){var d,a=a.split(/([\^_]?[a-zA-Z][',]*)/);d=Number(a.pop()||1);return[a.filter(function(a){return a}),d]})}function a(a,d,b,g,e,i){var m;h||(h=new l);m=h.currentTime+0.01;b=m+b*g;i=c(m,["square","sawtooth","triangle","sine"][i||0]);f[i].osc.frequency.setValueAtTime(a,m);f[i].osc.frequency.linearRampToValueAtTime(a+d*g,b);f[i].gain.gain.setValueAtTime(e,m);f[i].gain.gain.linearRampToValueAtTime(0,
b);f[i].t=b}function d(d){switch(d){case "move":a(100,-10,15,15,0.7,2);break;case "win":a(510,0,15,20,0.1);setTimeout(function(){a(2600,1,10,50,0.2)},80);break;case "open":a(220,15,15,15,0.3,2);break;case "close":a(440,-15,15,15,0.3,2);break;case "switch":a(750,-30,5,20,0.25);setTimeout(function(){a(150,30,5,20,0.25)},100);break;case "teleport":a(150,30,2,20,0.5,2);setTimeout(function(){a(150,30,2,20,0.5,2)},150);break;case "die":case "restart":a(100,-10,10,25,0.5);a(125,-5,20,45,0.1,1);a(40,2,20,
20,1,2);a(200,-4,10,100,0.25,2);break;case "turn":a(260,-60,15,15,0.4,2);break;case "drop-final":a(510,0,15,20,0.05);break;case "error":a(440,-15,15,15,0.5);setTimeout(function(){a(100,-10,10,25,0.5)},300);break;case "start":a(200,-30,5,10,0.5,2);break;case "wall":a(100,-30,15,10,0.5,2);break;case "ball":a(150,30,15,20,0.5,2);break;case "back":a(800,-40,30,15,0.5,2);break;case "random":a(500,-200,10,10,0.25,1)}}var g=!1,l,h,f=[],i;l=window.AudioContext||window.webkitAudioContext;(function(){var a,
d;a={E:Math.pow(2,-5/12)*440,G:Math.pow(2,-1/12)*440,A:440,B:Math.pow(2,2/12)*440,c:Math.pow(2,0.25)*440,d:Math.pow(2,5/12)*440,e:Math.pow(2,7/12)*440};d={"E,":Math.pow(2,-17/12)*220,"^F,":Math.pow(2,-1.25)*220,"G,":Math.pow(2,-14/12)*220,"^G,":Math.pow(2,-13/12)*220,"A,":110,"B,":Math.pow(2,-10/12)*220,C:Math.pow(2,-0.75)*220,D:Math.pow(2,-7/12)*220,E:Math.pow(2,-5/12)*220,G:Math.pow(2,-2/12)*220,"^G":Math.pow(2,-1/12)*220,A:220,B:Math.pow(2,2/12)*220,c:Math.pow(2,0.25)*220,d:Math.pow(2,5/12)*220,
e:Math.pow(2,7/12)*220,f:Math.pow(2,8/12)*220};a=[["A A A A A c B A G G G G G B A G A A A A A c B A G e E G A2 z2 c c c c c e d c B B B B B d c B A A A A A c B A G B e0.5 d0.5 c0.5 B0.5 A2 z2",a,0.1],["A, Ace E Ace A, Ace E Ace E ^Gde B, ^Gde E ^Gde B, ^Gde A, Ace E Ace A, Ace E Ace E ^Gde B, ^Gde A, Ace G,GBf2 C Gce G, Gce C Gce G, Gce G, GBd D GBd G, E, ^F, ^G, A, Ace E Ace A, Ace E Ace E ^Gde B, ^Gde A, Ace A,Ace2",d,0.15]];i=[];for(d=0;d<a.length;d++){var g=b(a[d][0]);i.push({time:-1,pos:0,notes:g,
key:a[d][1],volume:a[d][2],baseDur:0.5})}})();return{start:function(){g=!0},stop:function(){var a,d;g=!1;if(h){d=h.currentTime+0.1;for(a=0;a<f.length;a++)f[a].osc.frequency.cancelScheduledValues(d),f[a].gain.gain.cancelScheduledValues(d),f[a].gain.gain.setValueAtTime(0,d),f[a].t=d;for(a=0;a<i.length;a++)i[a].time=-1,i[a].pos=0}},tick:l?e:function(){},sound:l?d:function(){}}})();r=function(){function c(g){e&&(b||(b=g),e(a,g-b),b=g,d(c))}var e,b,a,d;d=window.requestAnimationFrame||window.mozRequestAnimationFrame;
(function(){function d(){var a=document.documentElement,a=Math.min(1,a.clientWidth/b.width,(a.clientHeight-(c.clientHeight||41))/b.height);a>0.75?a=0.75:a>2/3?a=2/3:a>0.5?a=0.5:a>1/3?a=1/3:a>0.25&&(a=0.25);a=Math.floor(b.width*a)+"px";b.style.width=a;c.style.width=a}var b=document.getElementById("canvas"),c=document.getElementById("header");b.width=960;b.height=1440;a=b.getContext("2d",{alpha:!1});window.addEventListener("resize",d);d()})();return{start:function(a){b=0;e=a;d(c)},stop:function(){e&&
e(a);e=!1},patterns:function(){var d=document.createElement("canvas"),b=d.getContext("2d"),c,f,i,k,e,j,m,n;d.width=32;d.height=32;for(f=0;f<32;f+=3)i=Math.floor(Math.random()*256),b.strokeStyle="rgba("+i+","+i+","+i+",0.3)",k=5*Math.random(),e=6+4*Math.random(),b.beginPath(),b.moveTo(f,0),b.bezierCurveTo(f+k,e,f-k,32-e,f,32),b.stroke();m=a.createPattern(d,"repeat");c=b.createImageData(32,32);for(f=0;f<4096;f+=4)i=Math.floor(Math.random()*256),c.data[f]=i,c.data[f+1]=i,c.data[f+2]=i,c.data[f+3]=50;
b.putImageData(c,0,0);n=a.createPattern(d,"repeat");j=32;c.data[2]=0;c.data[3]=128+Math.floor(Math.random()*32);c.data[126]=0;c.data[127]=128+Math.floor(Math.random()*32);c.data[3970]=0;c.data[3971]=128+Math.floor(Math.random()*32);c.data[4094]=0;for(c.data[4095]=128+Math.floor(Math.random()*32);j>1;){j/=2;for(k=j;k<32-j;k+=j)for(e=0;e<32;e+=2*j)i=c.data[(e*32+k-j)*4]+c.data[(e*32+k+j)*4],i=Math.floor(i/2+(Math.random()-0.5)*8*j),f=(e*32+k)*4,c.data[f]=i,c.data[f+1]=i,c.data[f+2]=0,c.data[f+3]=128+
Math.floor(Math.random()*32);for(e=j;e<32-j;e+=j)for(k=0;k<32;k+=2*j)i=c.data[((e-j)*32+k)*4]+c.data[((e+j)*32+k)*4],i=Math.floor(i/2+(Math.random()-0.5)*8*j),f=(e*32+k)*4,c.data[f]=i,c.data[f+1]=i,c.data[f+2]=0,c.data[f+3]=128+Math.floor(Math.random()*32)}b.putImageData(c,0,0);d=a.createPattern(d,"repeat");b=a.createRadialGradient(48,48,0,48,48,48);b.addColorStop(0,"#808");b.addColorStop(1,"#d0d");return{box:m,grass:n,fire:d,teleport:b}}()}}();w=function(){function c(a,d){this.type=a;d===0||d===
1?this.state=d:(this.data=d,this.state=0);this.drawState=this.state;this.animationTime=0}var e={fire:5E3,teleport:15E3},b={grass:function(a){a.fillStyle="#060";a.fillRect(0,0,96,96);a.fillStyle=r.patterns.grass;a.fillRect(0,0,96,96)},block:function(a){a.fillStyle="#310";a.fillRect(0,0,96,96);a.strokeStyle="#ffc";a.beginPath();a.moveTo(0,0);a.lineTo(96,0);a.moveTo(0,24);a.lineTo(96,24);a.moveTo(0,48);a.lineTo(96,48);a.moveTo(0,72);a.lineTo(96,72);a.moveTo(0,0);a.lineTo(0,24);a.moveTo(48,0);a.lineTo(48,
24);a.moveTo(0,48);a.lineTo(0,72);a.moveTo(48,48);a.lineTo(48,72);a.moveTo(24,24);a.lineTo(24,48);a.moveTo(72,24);a.lineTo(72,48);a.moveTo(24,72);a.lineTo(24,96);a.moveTo(72,72);a.lineTo(72,96);a.stroke()},fire:function(a,d){a.fillStyle="hsl(0,100%,"+(50+10*Math.sin(d*Math.PI/50))+"%)";a.fillRect(0,0,96,96);a.fillStyle=r.patterns.fire;a.fillRect(0,0,96,96)}};b.doc=function(a){b.grass(a);a.fillStyle="#fff";a.strokeStyle="#000";a.lineWidth=2;a.beginPath();a.moveTo(64,40);a.lineTo(48,24);a.lineTo(32,
24);a.lineTo(32,72);a.lineTo(64,72);a.lineTo(64,40);a.fill();a.lineTo(48,40);a.lineTo(48,24);a.stroke()};b.hdoor=function(a,d,c){d=48-c*46;b.grass(a);a.fillStyle="#aaa";a.beginPath();a.rect(0,0,d,12);a.rect(0,84,d,12);a.rect(96-d,0,d,12);a.rect(96-d,84,d,12);a.fill();a.fillStyle="#ccc";a.beginPath();a.rect(0,0,d,3);a.rect(0,84,d,3);a.rect(96-d,0,d,3);a.rect(96-d,84,d,3);a.fill();a.fillStyle="#888";a.beginPath();a.rect(0,6,d,3);a.rect(0,90,d,3);a.rect(96-d,6,d,3);a.rect(96-d,90,d,3);a.fill()};b.vdoor=
function(a,d,c){d=48-c*46;b.grass(a);a.fillStyle="#aaa";a.beginPath();a.rect(0,0,12,d);a.rect(84,0,12,d);a.rect(0,96-d,12,d);a.rect(84,96-d,12,d);a.fill();a.fillStyle="#ccc";a.beginPath();a.rect(0,0,3,d);a.rect(84,0,3,d);a.rect(0,96-d,3,d);a.rect(84,96-d,3,d);a.fill();a.fillStyle="#888";a.beginPath();a.rect(6,0,3,d);a.rect(90,0,3,d);a.rect(6,96-d,3,d);a.rect(90,96-d,3,d);a.fill()};b.trigger=function(a){b.grass(a);a.fillStyle="#aaa";a.fillRect(24,24,48,48);a.fillStyle="#ccc";a.beginPath();a.rect(24,
24,48,6);a.rect(24,24,6,48);a.fill();a.fillStyle="#888";a.beginPath();a.rect(30,66,42,6);a.rect(66,24,6,48);a.fill()};b.teleport=function(a,d){b.grass(a);a.fillStyle=r.patterns.teleport;a.beginPath();a.arc(48,48,24+8*Math.sin(d*Math.PI/50),0,2*Math.PI);a.fill()};c.prototype.canEnter=function(){return this.type==="vdoor"||this.type==="hdoor"?this.state===1:this.type!=="block"};c.prototype.getDeath=function(){return this.type==="fire"?1:(this.type==="vdoor"||this.type==="hdoor")&&this.state===0?2:this.type===
"teleport"?3:0};c.prototype.draw=function(a,d,c,l){var h=e[this.type]||1;l===void 0?(this.animationTime=0,this.drawState=this.state):(this.animationTime=(this.animationTime+l)%h,l*0.0010>=Math.abs(this.state-this.drawState)?this.drawState=this.state:this.drawState+=l*0.0010*(this.state>this.drawState?1:-1));a.save();a.translate(d*96,c*96);b[this.type](a,100*this.animationTime/h,this.drawState);a.restore()};return c}();x=function(){function c(a,b,c,e,f){a.fillStyle="#fff";a.strokeStyle="#000";a.beginPath();
a.arc(b,c,e,0,2*Math.PI);a.fill();a.stroke();a.fillStyle="#000";a.beginPath();a.arc(b,c-e/3+f,e/3,0,2*Math.PI);a.fill()}function e(a,b,c){this.type=a;this.drawX=this.x=b;this.drawY=this.y=c;this.animationTime=0}var b={yellow:1E4,blue:12E3,death:5E4},a={yellow:function(a,b){var e=0;a.translate(48,48);b>50&&b<55&&a.rotate(0.2*Math.sin((b-50)*Math.PI/2.5));a.lineWidth=2;a.strokeStyle="#cc0";a.fillStyle="#ff0";a.beginPath();a.rect(-38,-38,76,76);a.fill();a.stroke();a.lineWidth=1.5;b>70&&b<75&&(e=2-Math.max(0,
Math.abs(b-72.5)-0.5));c(a,-19.2,-9.6,9.6,e);c(a,19.2,-9.6,9.6,e)},blue:function(a,b){var e=0;a.translate(48,48);b>60&&b<70&&a.rotate(Math.sin((b-60)*Math.PI/5));a.lineWidth=2;a.strokeStyle="#36d";a.fillStyle="#58f";a.beginPath();a.arc(0,0,38.4,0,2*Math.PI);a.fill();a.stroke();a.lineWidth=1.5;b>20&&b<25&&(e=2-Math.max(0,Math.abs(b-22.5)-0.5));c(a,-19.2,-9.6,9.6,e);c(a,19.2,-9.6,9.6,e)},death:function(a,b){var c;a.fillStyle="#ffe";a.strokeStyle="#aaa";a.translate(48,72);a.save();a.rotate(Math.sin(b*
Math.PI/500)*Math.sin(b*Math.PI/5)/2);a.beginPath();a.moveTo(0,-8);a.lineTo(32,-8);a.bezierCurveTo(32,-8,40,-24,40,0);a.bezierCurveTo(40,24,32,8,32,8);a.lineTo(-32,8);a.bezierCurveTo(-32,8,-40,24,-40,0);a.bezierCurveTo(-40,-24,-32,-8,-32,-8);a.closePath();a.fill();a.stroke();a.restore();a.beginPath();a.moveTo(0,-67);a.bezierCurveTo(32,-67,40,-48,40,-32);a.bezierCurveTo(40,-10,4,19,0,19);a.bezierCurveTo(-4,19,-40,-10,-40,-32);a.bezierCurveTo(-40,-48,-32,-67,0,-67);a.fill();a.stroke();c=0;b>70&&b<75&&
(c=Math.max(0,Math.abs(b-72.5)-0.5)*60+240);a.fillStyle="hsl("+c+", 100%, 30%)";a.beginPath();a.arc(-19.2,-32,12,0,2*Math.PI);a.arc(19.2,-32,12,0,2*Math.PI);a.fill()},box:function(a){a.fillStyle="#732";a.fillRect(0,0,96,96);a.fillStyle="#954";a.fillRect(0,0,96,6);a.fillRect(0,0,6,96);a.fillStyle="#510";a.fillRect(90,0,6,96);a.fillRect(0,90,96,6);a.fillStyle=r.patterns.box;a.fillRect(0,0,96,96)}};e.prototype.setRoom=function(a){if(this.room!==a)this.room&&this.room.movables.splice(this.room.movables.indexOf(this),
1),this.room=a};e.prototype.getTile=function(){return this.room.getTile(this.x,this.y)};e.prototype.canMoveTo=function(a,b,c,e){return!this.room.canEnter(a,b)?!1:!this.room.isOccupied(a,b)?!0:this.room.canEnter(a+c,b+e)&&!this.room.isOccupied(a+c,b+e)};e.prototype.moveTo=function(a,b,c){this.drawX=c?a:this.x;this.drawY=c?b:this.y;this.x=a;this.y=b};e.prototype.draw=function(d,c){var e=b[this.type]||1,h,f,i;c===void 0?(this.animationTime=0,this.drawX=this.x,this.drawY=this.y):(this.animationTime=(this.animationTime+
c)%e,h=this.x-this.drawX,f=this.y-this.drawY,i=Math.sqrt(h*h+f*f),c*0.0050>=i?(this.drawX=this.x,this.drawY=this.y):(this.drawX+=h*c*0.0050/i,this.drawY+=f*c*0.0050/i));d.save();d.translate(this.drawX*96,this.drawY*96);a[this.type](d,100*this.animationTime/e);d.restore()};return e}();y=function(){function c(){}var e={"#":"block","~":"fire","!":"doc","-":"hdoor","|":"vdoor",".":"trigger","*":"trigger","?":"teleport"},b={0:"yellow",1:"blue",2:"death",3:"death",$:"box","*":"box"};c.prototype.init=function(a){var d=
0,c,l,h,f,i,k,m={};this.tiles=[];this.movables=[];for(h=0;h<15;h++){f=[];for(l=0;l<10;l++){c=a.map.charAt(d);if(i=b[c])k=new x(i,l,h),this.addMovable(k),m[i]=k;i=a[c]?a[c].shift():void 0;f.push(new w(e[c]||"grass",i));d++}this.tiles.push(f)}return m};c.prototype.addMovable=function(a){this.movables.indexOf(a)===-1&&(this.movables.push(a),a.setRoom(this))};c.prototype.getTile=function(a,b){return this.tiles[b][a]};c.prototype.canEnter=function(a,b){return b<0||b>=this.tiles.length?!1:a<0||a>=this.tiles[b].length?
!1:this.tiles[b][a].canEnter()};c.prototype.isOccupied=function(a,b){var c;for(c=0;c<this.movables.length;c++)if(this.movables[c].x===a&&this.movables[c].y===b)return this.movables[c];return!1};c.prototype.draw=function(a,b){var c,e;for(e=0;e<this.tiles.length;e++)for(c=0;c<this.tiles[e].length;c++)this.tiles[e][c].draw(a,c,e,b);for(c=0;c<this.movables.length;c++)this.movables[c].draw(a,b)};return c}();u=function(){function c(b){this.data=b}function e(b,a){return b.room===a.room&&Math.abs(b.x-a.x)+
Math.abs(b.y-a.y)<=1}c.prototype.init=function(){var b,a=JSON.parse(JSON.stringify(this.data));this.inverseMove=this.data.map.indexOf("3")>-1;this.rooms=[];do b=new y,this.rooms.push(b),b=b.init(a),a.map=a.map.slice(150),this.yellow=b.yellow||this.yellow,this.blue=b.blue||this.blue,this.death=b.death||this.death;while(a.map.length>0)};c.prototype.start=function(b){this.init();p.startKeys();r.start(this.draw.bind(this));this.state=0;this.user=b;this.time=Date.now()};c.prototype.stop=function(){p.stopKeys();
r.stop();return Math.max(1,Math.round((Date.now()-this.time)/1E3))};c.prototype.setUser=function(b){this.user=b};c.prototype.draw=function(b,a){[this.yellow,this.blue][this.user].room.draw(b,a)};c.prototype.getState=function(){return this.state};c.prototype.movePlayer=function(b,a,c){var e,l,h;e=b.x+a;l=b.y+c;if(b.canMoveTo(e,l,a,c))return(h=b.room.isOccupied(e,l))&&this.movePlayer(h,a,c),this.enterLeave(b,!1),b.moveTo(e,l),this.enterLeave(b,!0),!0};c.prototype.move=function(b,a,c){if(!this.state&&
(b=this.movePlayer(b===0?this.yellow:this.blue,a,c),this.state=this.checkEnd(),b&&this.state<=1))this.movePlayer(this.death,this.inverseMove?-a:a,this.inverseMove?-c:c),this.state=this.checkEnd()};c.prototype.enterLeave=function(b,a){var c=b.getTile();if(c.type==="doc")b===[this.yellow,this.blue][this.user]&&n.info(a?c.data:"",5);else if(c.type==="trigger")c=c.data,this.rooms[c[2]].getTile(c[0],c[1]).state=a?1:0;else if(c.type==="teleport"&&a)c=c.data,this.rooms[c[2]].isOccupied(c[0],c[1])||(this.rooms[c[2]].addMovable(b),
b.moveTo(c[0],c[1],!0))};c.prototype.checkDeath=function(b){return e(b,this.death)?1:(b=b.getTile().getDeath())?b+1:0};c.prototype.checkEnd=function(){var b,a;(b=this.checkDeath(this.yellow))&&(b*=2);return(a=this.checkDeath(this.blue))?2*a+1:b&&a?[b,a][this.user]:b?b:a?a:e(this.yellow,this.blue)?1:0};return c}();s=function(){var c={map:"0                                                                         2                                                                          1"};return[{title:"Tutorial",
desc:"Play these tutorial levels first.",lock:0,levels:[{map:"   #       0!          #      ####                  #####     #   #     # 2 #     #   #     ## ##                   ####      #          !1       #   ","!":["Welcome! Try to meet Blue, but avoid Death.","Welcome! Try to meet Yellow, but avoid Death."]},{map:"0  !          ~            ~               ~      ~        ~              3                ~      ~               ~      ~           ~            !  1","!":["This time Death will move the other way. And don\u2019t fall into the fire pits!",
"This time Death will move the other way. And don\u2019t fall into the fire pits!"]},{map:"0 !             .             #####-####                                  2                 .                 ####-#####                           ! 1","!":["The triggers will open and close the doors.","The triggers will open and close the doors."],".":[[4,11,0],[5,3,0]]},{map:"0 !           ?               ##########                                  2                                   ##########              ?            ! 1",
"!":["The teleporters will take you somewhere else. Let\u2019s hope the place is free and safe!","The teleporters will take you somewhere else. Let\u2019s hope the place is free and safe!"],"?":[[4,4,0],[5,10,0]]},{map:"0!$         $       $$$                             $$$$$     $   $     $ 2 $     $   $     $$$$$                              $$$       $ !       $ 1","!":["You can push boxes to a free place, but only one at a time.","You can push boxes to a free place, but only one at a time."]},
{map:"0         !       #-$      ## .      #         # #       #  ######### 2     . $ #########        #         # #?      #  $      ## !       #-1         ","!":["Boxes can press triggers, too.","Boxes can go through teleporters, too."],".":[[9,1,0],[9,13,0]],"?":[[7,7,0]]},{map:"0 !                                                                                                                                                  ??                                                                                                                                                  ! 1                                                                          2                                                                           ",
"!":["Where is Blue? Perhaps you should use the teleporter.","Where is Yellow? Perhaps you should use the teleporter."],"?":[[0,0,2],[9,14,2]]}]},{title:"Test",desc:"Test levels",lock:0,levels:[{map:"0                      #   ##    #  #      #  ###  # #    #   #   ##      2      ~ ~~  ~ ~ ~   ~ ~ ~ ~ ~~  ~~  ~   ~ ~ ~ ~ ~~  ~ ~                   1"},{map:"0         #### #### 1# #  # #  # ## # #  #  # # #  ##   #     ##### ##~  # 3  # ~ ## #### ~  #      ~ ### ####  #     #  #### #    #    ####   ~~      "},
{map:"0                                                                     ~~~~2~~~~~                                                                     1"},{map:"0 ??  ??    ??  ??  ??  ??  ????  ??  ??  ??  ??    ??  ??  ??  ??  ??~~~~2~~~~~??  ??  ??  ??  ??    ??  ??  ??  ??  ????  ??  ??  ??  ??    ??  ?? 1??  ??  ????  ??  ??  ??  ??    ??  ??  ??  ??  ????  ??  ??  ??  ??  ~~~~ ~~~~~  ??  ??  ??  ??  ????  ??  ??  ??  ??    ??  ??  ??  ??  ????  ??  ??","?":[[2,0,1],[3,0,1],[6,0,1],[7,0,
1],[2,1,1],[3,1,1],[6,1,1],[7,1,1],[0,2,1],[1,2,1],[4,2,1],[5,2,1],[8,2,1],[9,2,1],[0,3,1],[1,3,1],[4,3,1],[5,3,1],[8,3,1],[9,3,1],[2,4,1],[3,4,1],[6,4,1],[7,4,1],[2,5,1],[3,5,1],[6,5,1],[7,5,1],[0,6,1],[1,6,1],[4,6,1],[5,6,1],[8,6,1],[9,6,1],[0,8,1],[1,8,1],[4,8,1],[5,8,1],[8,8,1],[9,8,1],[2,9,1],[3,9,1],[6,9,1],[7,9,1],[2,10,1],[3,10,1],[6,10,1],[7,10,1],[0,11,1],[1,11,1],[4,11,1],[5,11,1],[8,11,1],[9,11,1],[0,12,1],[1,12,1],[4,12,1],[5,12,1],[8,12,1],[9,12,1],[2,13,1],[3,13,1],[6,13,1],[7,13,1],
[2,14,1],[3,14,1],[6,14,1],[7,14,1],[0,0,0],[1,0,0],[4,0,0],[5,0,0],[8,0,0],[9,0,0],[0,1,0],[1,1,0],[4,1,0],[5,1,0],[8,1,0],[9,1,0],[2,2,0],[3,2,0],[6,2,0],[7,2,0],[2,3,0],[3,3,0],[6,3,0],[7,3,0],[0,4,0],[1,4,0],[4,4,0],[5,4,0],[8,4,0],[9,4,0],[0,5,0],[1,5,0],[4,5,0],[5,5,0],[8,5,0],[9,5,0],[2,6,0],[3,6,0],[6,6,0],[7,6,0],[2,8,0],[3,8,0],[6,8,0],[7,8,0],[0,9,0],[1,9,0],[4,9,0],[5,9,0],[8,9,0],[9,9,0],[0,10,0],[1,10,0],[4,10,0],[5,10,0],[8,10,0],[9,10,0],[2,11,0],[3,11,0],[6,11,0],[7,11,0],[2,12,0],
[3,12,0],[6,12,0],[7,12,0],[0,13,0],[1,13,0],[4,13,0],[5,13,0],[8,13,0],[9,13,0],[0,14,0],[1,14,0],[4,14,0],[5,14,0],[8,14,0],[9,14,0]]},{map:"0         ~~~~~~~~~            ~~~~~~~~~          ~~~~~~~~~         ~  ~~~3~~~~  ~         ~~~~~~~~~          ~~~~~~~~~            ~~~~~~~~~         1"},{map:"0         #########            #########          ######### ####?####     2      ###?##### #########          #########            #########         1","?":[[0,7,0],[9,7,0]]},{map:"         0 ######### #########          ######### #### #### #### ####    $2$     ### ##### ### ##### #########          ######### ######### 1         "},
{map:"    0      # # # # # # # # # # # # # # #!#!#!#!#!#?#?#?#?#?########### ~  2   ~ ###########?#?#?#?#?#!#!#!#!#!# # # # # # # # # # # # # # #      1    ","!":"NO! Do not go here!,Yes! This is the right teleporter.,NO! Do not go here!,NO! Do not go here!,NO! Do not go here!,NO! Do not go here!,Yes! This is the right teleporter.,NO! Do not go here!,NO! Do not go here!,NO! Do not go here!".split(","),"?":[[0,7,0],[2,7,0],[0,7,0],[0,7,0],[0,7,0],[9,7,0],[3,7,0],[9,7,0],[9,7,0],[9,7,0]]},{map:"    0         !     ??????????##########          ??????????##########          ??????????##########          ??????????##########          ????????????????????          ##########??????????          ##########??????????          ##########??????????          ##########??????????    !         1                                                                               2                                                                           ",
"!":["Do you know the value of \u03c0? If not, then look it up before heading for the 3rd teleporter.","Do you know the value of Euler\u2019s number e? If not, then look it up before heading for the 2nd teleporter."],"?":[[4,0,0],[4,0,0],[4,4,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,7,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,10,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,13,0],[4,0,0],[4,0,0],[4,0,0],[4,0,
0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,2],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,0,0],[4,14,1],[4,14,2],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,1,1],[4,14,1],[4,14,1],[4,4,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,7,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,10,1],[4,
14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1],[4,14,1]]},{map:". . .# | # $$$ #-#-#.$0$.#-#-# $$$ | #-#. . .###-######### #              2               # #########-###. . .#-# | $$$ #-#-#.$1$.#-#-# $$$ # | #. . .",".":[[5,3,0],[6,2,0],[6,1,0],[7,0,0],[8,1,0],[8,2,0],[8,3,0],[8,4,0],[1,10,0],[1,11,0],[1,12,0],[1,13,0],[2,14,0],[3,13,0],[3,12,0],[4,11,0]]}]},{title:"Sokoban",desc:"Levels inspired by the Microban levels for Sokoban by David W Skinner",lock:0,levels:[{map:"####~~~~~~# .#~~~~~~#  #####~~#*0  | |  #  $ ###  #  ###    ####          2           ####      #. #  #####  #  | |  1*#~~### $  #~~~~###  #~~~~~~####",
".":[[7,3,0],[2,11,0]],"*":[[5,3,0],[4,11,0]],"|":[1,0,0,1]},{map:"###########        ## #0 ###-## $* #~#-## .* #~#-##    #~# ######### #    3                  ####    ###  ####-#     $ #-# #  #$ #   . .#1 ###########",".":[[8,2,0],[0,11,0],[0,12,0]],"*":[[8,3,0],[8,4,0]],"-":[0,1,1,0,0]},{map:"###########        ## .**$0#-##      #-######  #-#    #### #              2     # #########-##     ##-## .$. ##-## $1$ ##-#  .$. ##        ###########",".":[[8,2,0],[1,9,0],[1,10,0],[1,11,0],[1,12,0]],"*":[[8,
3,0],[8,4,0]],"-":[0,1,1,0,0,0,0]},{map:"##### ####    ###    $$     #2 $ #...      ###########           0              # ########  ~~      #-##-##-##     ~~   ####### ##    1               ",".":[[1,10,0],[4,10,0],[7,10,0]]},{map:"######~~~~     #~~~~ .$. #~~~~ $.$ ##### .$. # ..1 $.$ # $$   0  ## ## ###### #~-#2 ||  #~-# #### #~-# #    ##-# # #   #-# #   # #-# ###   #   ~~#####",".":[[0,8,0],[0,9,0],[0,10,0],[0,11,0],[0,12,0],[4,8,0],[5,8,0],[0,13,0]]},{map:"#####     #.  ##    #0$$ ##   ##   ||    ##  ##     ##.#       ##          2####-#   #.  #-#   #.# #-#####.# # 1 $ $ $ # # # # ###       #~~########~~",
".":[[5,3,0],[6,3,0],[0,8,0],[0,9,0],[0,10,0]]},{map:"0                                          ######    #    #    # ##3##-### # $ #-# ..# $ # #       # #  ###### ####                                  1",".":[[0,7,0],[0,8,0]]}]},{title:"Group 1",desc:"Solve all the tutorial levels to unlock. (Should include all but 3 from Test; 10, 11, 17?)",lock:7,levels:[c,c,c,c]},{title:"Group 2",desc:"Solve ten levels to unlock. (Should include all but 1 from Sokoban; 22?)",lock:10,levels:[c,c,c,c]},{title:"Bonus",
desc:"Bonus levels (Should include those 4 levels)",lock:"bonus",levels:[c,c,c,c]}]}();m=function(){function c(){b.hidden=!1;a.hidden=!0}function e(a){var b;if(a==="bonus"){if(!h){for(b=0;b<f.length;b++)if(f[b].lock==="bonus")document.querySelector('[data-level="'+b+'"]').disabled=!1;h=!0}}else if(a>l){for(b=0;b<f.length;b++)if(f[b].lock>l&&f[b].lock<=a)document.querySelector('[data-level="'+b+'"]').disabled=!1;l=a}}var b=document.getElementById("levels"),a=document.getElementById("game"),d,g,l,h,
f;return{init:function(){l=-1;h=!1;var a=b,d;d=[];var g,j,m,n;f=[];for(g=0;g<s.length;g++){d.push("<h2>"+s[g].title+"</h2>");d.push("<p>"+s[g].desc+"</p>");d.push("<p>");for(j=0;j<s[g].levels.length;j++)m=s[g].levels[j],n=f.length+1+'<br><span class="result">&nbsp;</span>',d.push('<button data-level="'+f.length+'" disabled>'+n+"</button> "),f.push({lock:s[g].lock,def:m});d.push("</p>")}d=d.join("");a.innerHTML=d;e(0);c()},end:function(){b.hidden=!0},getCurrentLevel:function(){return d},getCurrentLevelId:function(){return g},
unlock:e,markSolved:function(a,b){document.querySelector('[data-level="'+a+'"]').className="solved";document.querySelector('[data-level="'+a+'"] .result').textContent=Math.floor(b/60)+":"+(b%60<10?"0"+b%60:b%60)},runNextLevel:function(a){var b;b=g+1;f[b]?(b=f[b].lock,b=b==="bonus"?h:b<=l):b=!1;g=b?g+1:-1;g===-1?(d=!1,c()):(d=new u(f[g].def),d.start(a))},runLevel:function(c,e){g=c;d=new u(f[g].def);d.start(e);b.hidden=!0;a.hidden=!1},abortLevel:function(){d.stop();g=-1;d=!1;c()}}}();(function(){function c(){return location.search===
"?monetization-cheater"||document.monetization&&document.monetization.state==="started"}function e(d,k,o){var j=m.getCurrentLevel();switch(d){case "start":a.hidden=!0;g.hidden=!0;l.className=["yellow","blue"][k];p.start(b);m.init();Object.keys(h).forEach(function(a){m.markSolved(a,h[a])});b.msg("unlock",{data:Object.keys(h).length});c()&&b.msg("unlock",{data:"bonus"});break;case "end":p.stop();k===b.getUser()?(j&&m.abortLevel(),m.end(),a.hidden=!1):(n.modal("The other user quit. You can continue to play alone.",
function(){}),b=new q(e,b.getUser()),p.start(b));break;case "switch-user":l.className=["yellow","blue"][k];j&&j.setUser(k);break;case "move":if(j&&!j.getState()&&(j.move(k,o.x,o.y),d=j.getState())){j=j.stop();k=f[d-2];if(d===1&&(d=m.getCurrentLevelId(),k="Level solved again!",!h[d]||h[d]>j))k=h[d]?"Level solved faster than before!":"Level solved!",h[d]=j,v.set("solved",h),m.markSolved(d,j),b.msg("unlock",{data:Object.keys(h).length});n.info("");n.modal(k,function(){b.msg("continue")})}break;case "restart":j&&
!j.getState()&&(k!==b.getUser()&&n.info("Level restarted by other user"),j.stop(),j.start(b.getUser()));break;case "continue":j&&j.getState()&&(j.getState()>1?j.start(b.getUser()):m.runNextLevel(b.getUser()));break;case "select":j||(k!==b.getUser()&&n.info("Level selected by other user"),m.runLevel(o.level,b.getUser()));break;case "abort":j&&!j.getState()&&(k!==b.getUser()&&n.info("Level aborted by other user"),m.abortLevel());break;case "unlock":o.data==="bonus"&&!c()&&n.info("Bonus levels unlocked by other user"),
m.unlock(o.data)}}var b,a=document.getElementById("start"),d=document.getElementById("code"),g=document.getElementById("wait"),l=document.getElementById("switch"),h=v.get("solved"),f="Yellow died!,Blue died!,Yellow burnt!,Blue burnt!,Yellow was crushed in a closing door!,Blue was crushed in a closing door!,Yellow got stuck in a teleporter!,Blue got stuck in a teleporter!".split(",");(function(){var c,f;document.getElementById("alone").addEventListener("click",function(){b=new q(e)});c=document.getElementById("friend");
f=document.getElementById("random");o.isAvailable()?(c.addEventListener("click",function(){a.hidden=!0;d.hidden=!1}),f.addEventListener("click",function(){a.hidden=!0;g.hidden=!1;b=new o(e)})):(c.disabled=!0,f.disabled=!0);document.getElementById("connect").addEventListener("click",function(){d.hidden=!0;g.hidden=!1;b=new o(e,document.getElementById("input").value)});document.getElementById("back").addEventListener("click",function(){d.hidden=!0;a.hidden=!1});document.getElementById("cancel").addEventListener("click",
function(){b.close();g.hidden=!0;a.hidden=!1});o.isAvailable()||(b=new q(e))})()})()})();
</script>
</body></html>